function Game(e){var t=e||{},r=t.size||5;this.highestNumber=t.highestNumber||4,this.goalNumber=10;var i=t.state;this.directions={0:{col:0,row:-1},1:{col:1,row:0},2:{col:0,row:1},3:{col:-1,row:0}},this.setup(r,i)}function Grid(e){var t=e||{},r=t.highestNumber||4;this.size=t.size||5,this.cells=t.state?this.fromState(t.state):this.random(r)}function View(e){this.game=e,this.gridDiv=document.getElementById("grid"),this.gridDiv.addEventListener("click",this.merge.bind(this),!1),this.renderCells()}!function(){new View(new Game)}(),Game.prototype.setup=function(e,t){this.grid=new Grid({size:e,highestNumber:this.highestNumber,state:t})},Game.prototype.won=function(){return this.highestNumber===this.goalNumber},Game.prototype.finished=function(){return this.won()||!this.mergesAvailable()},Game.prototype.mergesAvailable=function(){return this.grid.eachCell(function(e,t){return this.canMerge(e,t)?!0:void 0}),!1},Game.prototype.directionVector=function(e){return this.directions[e]},Game.prototype.adjacentCell=function(e,t,r){var i=this.directionVector(r),o=e+i.row,n=t+i.col;return this.grid.outOfBounds(o,n)?void 0:{row:o,col:n,value:this.grid.cell(o,n)}},Game.prototype.canMerge=function(e,t){for(var r=this.grid.cell(e,t),i=0;4>i;i++){var o=this.adjacentCell(e,t,i);if(o&&r===o.value)return!0}return!1},Game.prototype.cellInArray=function(e,t){for(var r=0;r<t.length;r++)if(e.row===t[r].row&&e.col===t[r].col)return!0;return!1},Game.prototype.merge=function(e,t){if(this.canMerge(e,t)){var r={row:e,col:t,value:this.grid.cell(e,t)},i=this.getMergeable(r);this.incrementTarget(i.target);var o=this.replaceMergeable(i.cells,i.target);return{target:i.target,merged:i.cells,dropped:o.dropped,replaced:o.fromAbove}}},Game.prototype.getMergeable=function(e,t){for(var r=t||{cells:[],target:e},i=0;4>i;i++){var o=this.adjacentCell(e.row,e.col,i);o&&(this.cellInArray(o,r.cells)||r.target.value===o.value&&(o.col===r.target.col&&o.row>r.target.row&&(r.target=o),r.cells.push(o),r.cells.concat(this.getMergeable(o,r))))}return r},Game.prototype.incrementTarget=function(e){var t=e.value+1;t>this.highestNumber&&(this.highestNumber=t),this.grid.setCell(e.row,e.col,t)},Game.prototype.isTarget=function(e,t){return e&&t?e.col===t.col&&e.row===t.row:void 0},Game.prototype.replaceMergeable=function(e,t){var r=[],i=[];return this.grid.eachCell(function(o,n,s){var a={row:o,col:n,value:s};if(this.cellInArray(a,e)&&!this.isTarget(a,t)){var l={row:o-1,col:n,value:this.grid.cell(o-1,n)};l.value&&-1!==l.value?(this.grid.setCell(a.row,a.col,l.value),this.grid.setCell(l.row,l.col,-1),r.push(l),i.push(l)):(this.grid.setCell(a.row,a.col,-1),r.push(a))}}.bind(this)),r.forEach(function(e){this.grid.replaceWithRandom(e.row,e.col,this.highestNumber)}.bind(this)),{dropped:i,fromAbove:r}},Grid.prototype.eachCell=function(e){for(var t=0;t<this.size;t++)for(var r=0;r<this.size;r++){var i=this.cells[t][r];e(t,r,i)}},Grid.prototype.fromState=function(e){for(var t=[],r=0,i=0;i<this.size;i++){for(var o=[],n=0;n<this.size;n++)o.push(parseInt(e[r])),r++;t.push(o)}return t},Grid.prototype.random=function(e){for(var t=[],r=0;r<this.size;r++){for(var i=[],o=0;o<this.size;o++)i.push(this.randomNumber(e));t.push(i)}return t},Grid.prototype.randomNumber=function(e){return Math.floor(Math.random()*e+1)},Grid.prototype.cell=function(e,t){return this.outOfBounds(e,t)?void 0:this.cells[e][t]},Grid.prototype.replaceWithRandom=function(e,t,r){!this.outOfBounds(e,t)&&r&&(this.cells[e][t]=this.randomNumber(r))},Grid.prototype.setCell=function(e,t,r){1>r||this.outOfBounds(e,t)||(this.cells[e][t]=r)},Grid.prototype.outOfBounds=function(e,t){var r=0>e||e>=this.size,i=0>t||t>=this.size;return r||i},Grid.prototype.toString=function(){var e="";return this.eachCell(function(t,r,i){e+=i}),e},View.prototype.renderCells=function(){this.game.grid.size;this.game.grid.eachCell(function(e,t,r){var i=document.createElement("div");i.className="cell",i.innerHTML="<h1>"+r+"</h1>",i.dataset.row=e,i.dataset.col=t,this.gridDiv.appendChild(i)}.bind(this))},View.prototype.getTargetCell=function(e){var t;if(e.classList.contains("cell"))t=e;else{if(!e.parentElement.classList.contains("cell"))return;t=e.parentElement}return{row:parseInt(t.dataset.row),col:parseInt(t.dataset.col),value:parseInt(t.firstChild.innerHTML)}},View.prototype.merge=function(){var e=this.getTargetCell(event.target);if(e){var t=this.game.merge(e.row,e.col);t&&(this.renderMerge(t.merged,t.target),this.renderDrop(t.dropped),this.renderReplace(t.replaced))}},View.prototype.renderMerge=function(e,t){},View.prototype.renderDrop=function(e){},View.prototype.renderReplace=function(e){};